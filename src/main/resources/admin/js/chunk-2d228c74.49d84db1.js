(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d228c74"],{db44:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-row",{attrs:{gutter:12}},[n("a-col",{attrs:{span:24}},[n("div",{staticStyle:{"margin-bottom":"16px"}},[n("a-input",{attrs:{size:"large",placeholder:"请输入文章标题"},model:{value:t.postToStage.title,callback:function(e){t.$set(t.postToStage,"title",e)},expression:"postToStage.title"}})],1),n("div",{attrs:{id:"editor"}},[n("MarkdownEditor",{attrs:{originalContent:t.postToStage.originalContent},on:{onSaveDraft:function(e){return t.handleSaveDraft(!0)},onContentChange:t.onContentChange}})],1)])],1),n("PostSettingDrawer",{attrs:{post:t.postToStage,tagIds:t.selectedTagIds,categoryIds:t.selectedCategoryIds,metas:t.selectedMetas,visible:t.postSettingVisible},on:{close:t.onPostSettingsClose,onRefreshPost:t.onRefreshPostFromSetting,onRefreshTagIds:t.onRefreshTagIdsFromSetting,onRefreshCategoryIds:t.onRefreshCategoryIdsFromSetting,onRefreshPostMetas:t.onRefreshPostMetasFromSetting,onSaved:t.onSaved}}),n("AttachmentDrawer",{model:{value:t.attachmentDrawerVisible,callback:function(e){t.attachmentDrawerVisible=e},expression:"attachmentDrawerVisible"}}),n("footer-tool-bar",{style:{width:t.isSideMenu()&&t.isDesktop()?"calc(100% - "+(t.sidebarOpened?256:80)+"px)":"100%"}},[n("a-button",{attrs:{type:"danger",loading:t.draftSaving},on:{click:function(e){return t.handleSaveDraft(!1)}}},[t._v("保存草稿")]),n("a-button",{staticStyle:{"margin-left":"8px"},attrs:{loading:t.previewSaving},on:{click:t.handlePreview}},[t._v("预览")]),n("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:t.handleShowPostSetting}},[t._v("发布")]),n("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"dashed"},on:{click:function(e){t.attachmentDrawerVisible=!0}}},[t._v("附件库")])],1)],1)},o=[],i=n("ac0d"),s=n("c1df"),r=n.n(s),d=n("86db"),l=n("ed4e"),c=n("5a70"),g=n("fa70"),h=n("caf6"),u={mixins:[i["a"],i["b"]],components:{PostSettingDrawer:d["a"],FooterToolBar:c["a"],AttachmentDrawer:l["a"],MarkdownEditor:g["a"]},data:function(){return{contentChanged:!1,timer:null,attachmentDrawerVisible:!1,postSettingVisible:!1,postToStage:{},selectedTagIds:[],selectedCategoryIds:[],selectedMetas:[],isSaved:!1,contentChanges:0,draftSaving:!1,previewSaving:!1}},beforeRouteEnter:function(t,e,n){var a=t.query.postId;n((function(t){a&&h["a"].get(a).then((function(e){var n=e.data.data;t.postToStage=n,t.selectedTagIds=n.tagIds,t.selectedCategoryIds=n.categoryIds,t.selectedMetas=n.metas}))}))},beforeDestroy:function(){clearInterval(this.timer)},destroyed:function(){this.postSettingVisible&&(this.postSettingVisible=!1),this.attachmentDrawerVisible&&(this.attachmentDrawerVisible=!1),window.onbeforeunload&&(window.onbeforeunload=null)},beforeRouteLeave:function(t,e,n){this.$createElement;this.postSettingVisible&&(this.postSettingVisible=!1),this.attachmentDrawerVisible&&(this.attachmentDrawerVisible=!1),this.contentChanges<=1||this.isSaved?n():this.$confirm({title:"当前页面数据未保存，确定要离开吗？",content:function(t){return t("div",{style:"color:red;"},["如果离开当面页面，你的数据很可能会丢失！"])},onOk:function(){n()},onCancel:function(){n(!1)}})},mounted:function(){window.onbeforeunload=function(t){return t=t||window.event,t&&(t.returnValue="当前页面数据未保存，确定要离开吗？"),"当前页面数据未保存，确定要离开吗？"},this.autoSave()},watch:{temporaryContent:function(t,e){t&&this.contentChanges++},"postToStage.originalContent":function(){this.contentChanged=!0}},computed:{temporaryContent:function(){return this.postToStage.originalContent}},methods:{handleSaveDraft:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.contentChanged=!1,this.$log.debug("Draft only: "+e),this.postToStage.status="DRAFT",this.postToStage.title||(this.postToStage.title=r()(new Date).format("YYYY-MM-DD-HH-mm-ss")),this.draftSaving=!0,this.postToStage.id?e?h["a"].updateDraft(this.postToStage.id,this.postToStage.originalContent).then((function(e){n||t.$message.success("保存草稿成功！")})).finally((function(){t.draftSaving=!1})):h["a"].update(this.postToStage.id,this.postToStage,!1).then((function(e){t.$log.debug("Updated post",e.data.data),n||t.$message.success("保存草稿成功！"),t.postToStage=e.data.data})).finally((function(){t.draftSaving=!1})):h["a"].create(this.postToStage,!1).then((function(e){t.$log.debug("Created post",e.data.data),n||t.$message.success("保存草稿成功！"),t.postToStage=e.data.data})).finally((function(){t.draftSaving=!1}))},handleShowPostSetting:function(){this.postSettingVisible=!0},handlePreview:function(){var t=this;this.postToStage.status="DRAFT",this.postToStage.title||(this.postToStage.title=r()(new Date).format("YYYY-MM-DD-HH-mm-ss")),this.previewSaving=!0,this.postToStage.id?h["a"].update(this.postToStage.id,this.postToStage,!1).then((function(e){t.$log.debug("Updated post",e.data.data),h["a"].preview(t.postToStage.id).then((function(t){window.open(t.data,"_blank")})).finally((function(){t.previewSaving=!1}))})):h["a"].create(this.postToStage,!1).then((function(e){t.$log.debug("Created post",e.data.data),t.postToStage=e.data.data,h["a"].preview(t.postToStage.id).then((function(t){window.open(t.data,"_blank")})).finally((function(){t.previewSaving=!1}))}))},onContentChange:function(t){this.postToStage.originalContent=t},onPostSettingsClose:function(){this.postSettingVisible=!1},onRefreshPostFromSetting:function(t){this.postToStage=t},onRefreshTagIdsFromSetting:function(t){this.selectedTagIds=t},onRefreshCategoryIdsFromSetting:function(t){this.selectedCategoryIds=t},onRefreshPostMetasFromSetting:function(t){this.selectedMetas=t},onSaved:function(t){this.isSaved=t},autoSave:function(){var t=this;this.timer=setInterval((function(){t.contentChanged&&t.handleSaveDraft(!0,!0)}),7e3)}}},f=u,p=n("2877"),S=Object(p["a"])(f,a,o,!1,null,null,null);e["default"]=S.exports}}]);